<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Logging in functional style | Zena Software</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="Consulenza tecnologie Big Data e Cloud">
    
    <link rel="preload" href="/assets/css/0.styles.eb95a9dd.css" as="style"><link rel="preload" href="/assets/js/app.a2df8847.js" as="script"><link rel="preload" href="/assets/js/2.61b454c1.js" as="script"><link rel="preload" href="/assets/js/15.e89b47ed.js" as="script"><link rel="prefetch" href="/assets/js/10.13e980c8.js"><link rel="prefetch" href="/assets/js/11.4fda546e.js"><link rel="prefetch" href="/assets/js/12.0ae2261a.js"><link rel="prefetch" href="/assets/js/13.5c1f4866.js"><link rel="prefetch" href="/assets/js/14.bdc856fe.js"><link rel="prefetch" href="/assets/js/16.5ea0211c.js"><link rel="prefetch" href="/assets/js/3.2fb56fba.js"><link rel="prefetch" href="/assets/js/4.09f84c1d.js"><link rel="prefetch" href="/assets/js/5.2f0f6adc.js"><link rel="prefetch" href="/assets/js/6.40cfdc13.js"><link rel="prefetch" href="/assets/js/7.35a44985.js"><link rel="prefetch" href="/assets/js/8.6759414c.js"><link rel="prefetch" href="/assets/js/9.5055760e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.eb95a9dd.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Zena Software</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="logging-in-functional-style"><a href="#logging-in-functional-style" class="header-anchor">#</a> Logging in functional style</h1> <p>Consider this small program</p> <div class="el-tabs el-tabs--card el-tabs--top"><div class="el-tabs__header is-top"><div class="el-tabs__nav-wrap is-top"><div class="el-tabs__nav-scroll"><div role="tablist" class="el-tabs__nav is-top" style="transform:translateX(-0px);"></div></div></div></div><div class="el-tabs__content"><div role="tabpanel" aria-hidden="true" id="pane-null" aria-labelledby="tab-null" class="el-tab-pane" style="display:none;"><div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">object</span> Main <span class="token keyword">extends</span> App <span class="token punctuation">{</span>
  println<span class="token punctuation">(</span><span class="token string">&quot;Starting engine...&quot;</span><span class="token punctuation">)</span>
  Thread<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>
  println<span class="token punctuation">(</span><span class="token string">&quot;All work done!&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <div role="tabpanel" aria-hidden="true" id="pane-null" aria-labelledby="tab-null" class="el-tab-pane" style="display:none;"><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">sleep</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ms</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">r</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> ms<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Starting engine...'</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'All work done!'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div></div></div></div> <p>This could be anything really but let's imagine we are writing a batch job (ETL) to display some stats to the customer. Whatever it is you want to have some logging. It's always good practice to have good monitoring in place if you are building a professional system.</p> <p>Now, what often happens is that the company grows and now you need two of the same.</p> <div class="el-tabs el-tabs--card el-tabs--top"><div class="el-tabs__header is-top"><div class="el-tabs__nav-wrap is-top"><div class="el-tabs__nav-scroll"><div role="tablist" class="el-tabs__nav is-top" style="transform:translateX(-0px);"></div></div></div></div><div class="el-tabs__content"><div role="tabpanel" aria-hidden="true" id="pane-null" aria-labelledby="tab-null" class="el-tab-pane" style="display:none;"><div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">object</span> Main <span class="token keyword">extends</span> App <span class="token punctuation">{</span>
  println<span class="token punctuation">(</span><span class="token string">&quot;Starting engine 1...&quot;</span><span class="token punctuation">)</span>
  Thread<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>
  println<span class="token punctuation">(</span><span class="token string">&quot;All work done for 1!&quot;</span><span class="token punctuation">)</span>
  println<span class="token punctuation">(</span><span class="token string">&quot;Starting engine 2...&quot;</span><span class="token punctuation">)</span>
  Thread<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span>
  println<span class="token punctuation">(</span><span class="token string">&quot;All work done for 2!&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <div role="tabpanel" aria-hidden="true" id="pane-null" aria-labelledby="tab-null" class="el-tab-pane" style="display:none;"><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">sleep</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ms</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">r</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> ms<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Starting engine 1...'</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'All work done for 1!'</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Starting engine 2...'</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'All work done for 2!'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div></div></div></div> <p>This is fantastic spaghetti code and it will work. The problem will come as soon as you have to factor in all the little details. Let's take two:</p> <ul><li>maintainability</li> <li>concurrency</li></ul> <h3 id="maintainability"><a href="#maintainability" class="header-anchor">#</a> Maintainability</h3> <p>Tomorrow you will have to read this code again. Or maybe a year from now. Someone else might have to read it as well. Even worse this code will need to be modified, bugs will need to be fixed, features added or remove, integrations done.</p> <p>There is no structure in the code that will help with that. Spaghetti code is the perfect material to <a href="https://www.aau.at/wp-content/uploads/2019/11/Romano2012-antipatterns.pdf" target="_blank" rel="noopener noreferrer">introduce new bugs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and to <a href="https://papyrus.bib.umontreal.ca/xmlui/bitstream/handle/1866/4636/abbes_marwen_2010_memoire.pdf?sequence=4" target="_blank" rel="noopener noreferrer">slow development<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>How do we cope with that? We have to introduce structure, documentation and expressiveness.</p> <h3 id="concurrency"><a href="#concurrency" class="header-anchor">#</a> Concurrency</h3> <p>The second engine only starts after the first one is done. This means that potentially we are going much slower than it's possible. However if our program is sharing state, we can't simply run the two jobs in two separate programs. Maybe they talk to the same database and might step on each other's toes so there needs to be a good degree of cordination.</p> <h2 id="adding-structure"><a href="#adding-structure" class="header-anchor">#</a> Adding structure</h2> <p>A more organized version of the above program might be the following</p> <div class="el-tabs el-tabs--card el-tabs--top"><div class="el-tabs__header is-top"><div class="el-tabs__nav-wrap is-top"><div class="el-tabs__nav-scroll"><div role="tablist" class="el-tabs__nav is-top" style="transform:translateX(-0px);"></div></div></div></div><div class="el-tabs__content"><div role="tabpanel" aria-hidden="true" id="pane-null" aria-labelledby="tab-null" class="el-tab-pane" style="display:none;"><div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">object</span> Main <span class="token keyword">extends</span> App <span class="token punctuation">{</span>
  <span class="token keyword">def</span> program<span class="token punctuation">(</span>engineNo<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    println<span class="token punctuation">(</span>s<span class="token string">&quot;Starting engine $engineNo...&quot;</span><span class="token punctuation">)</span>
    Thread<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1000</span> <span class="token operator">*</span> engineNo<span class="token punctuation">)</span>
    println<span class="token punctuation">(</span>s<span class="token string">&quot;All work done for $engineNo&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  program<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  program<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <div role="tabpanel" aria-hidden="true" id="pane-null" aria-labelledby="tab-null" class="el-tab-pane" style="display:none;"><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">sleep</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ms</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">r</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> ms<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">program</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">engineNo</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Starting engine'</span> <span class="token operator">+</span> engineNo <span class="token operator">+</span> <span class="token string">'...'</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span> <span class="token operator">*</span> engineNo<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'All work done for '</span> <span class="token operator">+</span> engineNo <span class="token operator">+</span> <span class="token string">'!'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">program</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token function">program</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
</code></pre></div></div></div></div> <p>Duplication has been removed and the program is certainly more maintainable, this is good.</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.a2df8847.js" defer></script><script src="/assets/js/2.61b454c1.js" defer></script><script src="/assets/js/15.e89b47ed.js" defer></script>
  </body>
</html>
