(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{392:function(a,t,s){"use strict";s.r(t);var e=s(9),n=Object(e.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"come-sviluppare-un-api-rest-in-6-minuti"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#come-sviluppare-un-api-rest-in-6-minuti"}},[a._v("#")]),a._v(" Come sviluppare un’API REST in 6 minuti")]),a._v(" "),s("p",[a._v("Sei nel mezzo di un hackaton e devi mettere su un microservizio? Il tuo capo ti ha sbolognato da fare un API per un cliente da finire entro ieri? In questo breve (anzi brevissimo) tutorial, costruirai un’API REST in men che non si dica.")]),a._v(" "),s("h2",{attrs:{id:"query-ad-un-database-di-date"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#query-ad-un-database-di-date"}},[a._v("#")]),a._v(" Query ad un database di date")]),a._v(" "),s("p",[a._v("Come problema di esempio useremo delle query ad un calendario che ci restituirà informazioni sui giorni di festa.")]),a._v(" "),s("h2",{attrs:{id:"passo-0-requisiti"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#passo-0-requisiti"}},[a._v("#")]),a._v(" Passo 0: requisiti")]),a._v(" "),s("p",[a._v("Ok, forse questo passo non conta nei 6 minuti, ma è importante installare un paio di cosette prima di cominciare.")]),a._v(" "),s("h4",{attrs:{id:"postgres"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#postgres"}},[a._v("#")]),a._v(" Postgres")]),a._v(" "),s("p",[a._v("Presupponendo che tu abbia "),s("code",[a._v("Docker")]),a._v(" installato, puoi tirare su una base dati Postgres con i seguenti comandi da shell:")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# crea una rete per la nostra base dati")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" docker network create db\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# lancia il database")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" docker run --detach --rm --name calendario --env "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("POSTGRES_PASSWORD")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("banana --env "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("POSTGRES_DB")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("calendar_api --publish "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5432")]),a._v(":5432 --network db postgres\n")])])]),s("p",[a._v("Per controllare se la connessione al database funziona:")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("docker run -it --rm --network"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("db postgres psql -h calendario -U postgres\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" Password "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" user postgres:\n")])])]),s("p",[a._v('Inserisci la password impostata poco sopra che è "banana". Ti si prensenta (se tutto è andato bene) la console di Postgres.')]),a._v(" "),s("p",[a._v("Crea una tabella che poi userai per memorizzare i dati:")]),a._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("CREATE")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("TABLE")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"giorno"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"id"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("serial")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("primary")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"createdAt"')]),a._v(" timestamptz "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("NOT")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("NULL")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"updatedAt"')]),a._v(" timestamptz "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("NOT")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("NULL")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"data"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("date")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("NOT")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("NULL")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"evento"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("varchar")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("NOT")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("NULL")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[a._v("A completamento del comando, per uscire, basta digitare "),s("code",[a._v("exit")]),a._v(".")]),a._v(" "),s("h4",{attrs:{id:"feathers-js"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#feathers-js"}},[a._v("#")]),a._v(" Feathers.js")]),a._v(" "),s("p",[a._v("Feathers.js è l’API layer che ci permette di generare il codice del microservizio.")]),a._v(" "),s("p",[a._v("Se usi javascript probabilmente hai "),s("code",[a._v("npm")]),a._v(" già installato, quindi con il seguente comando puoi installare Feathers:")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" @feathersjs/cli -g\n")])])]),s("h2",{attrs:{id:"passo-1"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#passo-1"}},[a._v("#")]),a._v(" Passo 1")]),a._v(" "),s("p",[a._v("Crea una nuova cartella, una volta dentro digita")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("> feathers generate app\n")])])]),s("p",[a._v("Rispondi alle domande interattive (le scelte di default vanno bene per questo tutorial)")]),a._v(" "),s("h2",{attrs:{id:"passo-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#passo-2"}},[a._v("#")]),a._v(" Passo 2")]),a._v(" "),s("p",[a._v("Feathers ha generato un’impalcatura sulla quale costruire la nostra applicazione. Con il comando "),s("code",[a._v("npm start")]),a._v(" puoi lanciarla ma sarà ancora vuota.")]),a._v(" "),s("p",[a._v("Con il prossimo comando generi codice per l’API endpoint:")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("> feathers generate service\n")])])]),s("p",[a._v("Alle domande che seguono rispondi che si tratta di un servizio "),s("code",[a._v("Sequelize")]),a._v(" e usa "),s("code",[a._v("giorno")]),a._v(" come nome. Infine scegli "),s("code",[a._v("PostgreSQL")]),a._v(" quando richiesto. L’ultima domanda riguarda l’indirizzo del nostro database. Bisogna prestare un attimo di attenzione perché l’indirizzo proposto di default sarà")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("postgres://postgres:@localhost:5432/calendar_api\n")])])]),s("p",[a._v("che nel nostro caso va bene, eccettuato il fatto che manca la password, che va inserita dopo i due punti come segue:")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("postgres://postgres:banana@localhost:5432/calendar_api\n")])])]),s("h2",{attrs:{id:"passo-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#passo-3"}},[a._v("#")]),a._v(" Passo 3")]),a._v(" "),s("p",[a._v("In grosso è fatto, ma la nostra API non ha ancora un modello. Navigando nella struttura creata da Feathers, apri il file "),s("code",[a._v("src/models/giorno.model.js")]),a._v(". Il codice che definisce il modello è il seguente:")]),a._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("const")]),a._v(" giorno "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" sequelizeClient"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("define")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'giorno'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    text"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n      type"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" DataTypes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("STRING")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n      allowNull"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("false")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// altro codice riguardante gli hooks")]),a._v("\n")])])]),s("p",[a._v("In pratica questo codice dice che la struttura della nostra risorsa è semplicemente una stringa. Quello che vogliamo creare è invece qualcosa del genere")]),a._v(" "),s("table",[s("thead",[s("tr",[s("th",[a._v("data")]),a._v(" "),s("th",[a._v("evento")])])]),a._v(" "),s("tbody",[s("tr",[s("td",[a._v("25-12-2019")]),a._v(" "),s("td",[a._v("natale")])]),a._v(" "),s("tr",[s("td",[a._v("26-12-2019")]),a._v(" "),s("td",[a._v("s. stefano")])])])]),a._v(" "),s("p",[a._v("Per ottenerlo dobbiamo modificare il codice come segue:")]),a._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("const")]),a._v(" giorno "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" sequelizeClient"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("define")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'giorno'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    data"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n      type"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" DataTypes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("DATEONLY")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n      allowNull"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("false")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    evento"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n      type"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" DataTypes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("STRING")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n      allowNull"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("false")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// ... hooks ...")]),a._v("\n")])])]),s("p",[a._v("Salva il file così modificato.")]),a._v(" "),s("h2",{attrs:{id:"passo-4"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#passo-4"}},[a._v("#")]),a._v(" Passo 4")]),a._v(" "),s("p",[a._v("Congratulazioni, il servizio è completo! È ora di provarlo. Se hai installato "),s("a",{attrs:{href:"https://httpie.org/",target:"_blank",rel:"noopener noreferrer"}},[a._v("http pie"),s("OutboundLink")],1),a._v(" puoi usare il comando:")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[a._v("http POST :3030/giorno data=2019-12-25 evento=natale\n")])])]),s("p",[a._v("Altrimenti con "),s("code",[a._v("curl")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[a._v('curl -d \'{"data":"2019-12-26", "evento":"s. stefano"}\' -H "Content-Type: application/json" -X POST http://localhost:3030/giorno\n')])])]),s("p",[a._v("I comandi qui sopra creano nuove risorse, per controllare il risultato possiamo andare all’indirizzo qui sotto con il browser")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[a._v("http://localhost:3030/giorno\n")])])]),s("p",[a._v("Supponiamo di volere effettuare una query solo per i giorno successivi a natale. Sequelize offre la seguente sintassi di serie:")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[a._v("http://localhost:3030/giorno?data[$gt]=2019-12-25\n")])])]),s("p",[a._v("Dove il "),s("code",[a._v("$gt")]),a._v(' sta per "greater than".')]),a._v(" "),s("h2",{attrs:{id:"conclusione"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#conclusione"}},[a._v("#")]),a._v(" Conclusione")]),a._v(" "),s("p",[a._v("Prototipare un’API non è mai stato così veloce e semplice. Tuttavia non bisogna farsi ingannare dalla troppa semplicità di questi strumenti innovativi. Il microservizio che abbiamo costruito in pochi minuti potrà anche funzionare e avere tutte le funzionalità che cercavamo inizialmente, ma in ogni sistema informativo che si rispetti questo è destinato a cambiare.")]),a._v(" "),s("p",[a._v("Con l’aumentare delle richieste di funzionalità sarà necessario aggiungere una struttura del codice più robusta o integrare con altri componenti software. Talvolta l’impostazione iniziale è talmente diversa dall’obiettivo che vogliamo raggiungere che è necessario cominciare da zero e riscrivere tutto in un linguaggio più estensibile e con tecnologie più flessibili.")]),a._v(" "),s("hr"),a._v(" "),s("p",[s("a",{attrs:{href:"https://www.linkedin.com/in/gurghet/?locale=it_ITs",target:"_blank",rel:"noopener noreferrer"}},[s("em",[a._v("Andrea Passaglia")]),s("OutboundLink")],1)]),a._v(" "),s("p",[s("htmlcommentbox")],1)])}),[],!1,null,null,null);t.default=n.exports}}]);