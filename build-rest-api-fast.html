<!DOCTYPE html>
<html lang="it-IT">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Sviluppare API REST in 6 minuti | Zena Software</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="Consulenza tecnologie Big Data e Cloud">
    <meta content="Questo tutorial ti spiega passo passo come mettere su un servizio di API REST-ful usando Javascript, Postgres e Featherjs in tempo record.">
    
    <link rel="preload" href="/assets/css/0.styles.eb95a9dd.css" as="style"><link rel="preload" href="/assets/js/app.a2df8847.js" as="script"><link rel="preload" href="/assets/js/2.61b454c1.js" as="script"><link rel="preload" href="/assets/js/14.bdc856fe.js" as="script"><link rel="preload" href="/assets/js/9.5055760e.js" as="script"><link rel="prefetch" href="/assets/js/10.13e980c8.js"><link rel="prefetch" href="/assets/js/11.4fda546e.js"><link rel="prefetch" href="/assets/js/12.0ae2261a.js"><link rel="prefetch" href="/assets/js/13.5c1f4866.js"><link rel="prefetch" href="/assets/js/15.e89b47ed.js"><link rel="prefetch" href="/assets/js/16.5ea0211c.js"><link rel="prefetch" href="/assets/js/3.2fb56fba.js"><link rel="prefetch" href="/assets/js/4.09f84c1d.js"><link rel="prefetch" href="/assets/js/5.2f0f6adc.js"><link rel="prefetch" href="/assets/js/6.40cfdc13.js"><link rel="prefetch" href="/assets/js/7.35a44985.js"><link rel="prefetch" href="/assets/js/8.6759414c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.eb95a9dd.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Zena Software</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="come-sviluppare-un-api-rest-in-6-minuti"><a href="#come-sviluppare-un-api-rest-in-6-minuti" class="header-anchor">#</a> Come sviluppare un’API REST in 6 minuti</h1> <p>Sei nel mezzo di un hackaton e devi mettere su un microservizio? Il tuo capo ti ha sbolognato da fare un API per un cliente da finire entro ieri? In questo breve (anzi brevissimo) tutorial, costruirai un’API REST in men che non si dica.</p> <h2 id="query-ad-un-database-di-date"><a href="#query-ad-un-database-di-date" class="header-anchor">#</a> Query ad un database di date</h2> <p>Come problema di esempio useremo delle query ad un calendario che ci restituirà informazioni sui giorni di festa.</p> <h2 id="passo-0-requisiti"><a href="#passo-0-requisiti" class="header-anchor">#</a> Passo 0: requisiti</h2> <p>Ok, forse questo passo non conta nei 6 minuti, ma è importante installare un paio di cosette prima di cominciare.</p> <h4 id="postgres"><a href="#postgres" class="header-anchor">#</a> Postgres</h4> <p>Presupponendo che tu abbia <code>Docker</code> installato, puoi tirare su una base dati Postgres con i seguenti comandi da shell:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token comment"># crea una rete per la nostra base dati</span>
<span class="token operator">&gt;</span> docker network create db
<span class="token operator">&gt;</span> <span class="token comment"># lancia il database</span>
<span class="token operator">&gt;</span> docker run --detach --rm --name calendario --env <span class="token assign-left variable">POSTGRES_PASSWORD</span><span class="token operator">=</span>banana --env <span class="token assign-left variable">POSTGRES_DB</span><span class="token operator">=</span>calendar_api --publish <span class="token number">5432</span>:5432 --network db postgres
</code></pre></div><p>Per controllare se la connessione al database funziona:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>docker run -it --rm --network<span class="token operator">=</span>db postgres psql -h calendario -U postgres
<span class="token operator">&gt;</span> Password <span class="token keyword">for</span> user postgres:
</code></pre></div><p>Inserisci la password impostata poco sopra che è &quot;banana&quot;. Ti si prensenta (se tutto è andato bene) la console di Postgres.</p> <p>Crea una tabella che poi userai per memorizzare i dati:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token string">&quot;giorno&quot;</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;id&quot;</span> <span class="token keyword">serial</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
    <span class="token string">&quot;createdAt&quot;</span> timestamptz <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token string">&quot;updatedAt&quot;</span> timestamptz <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token string">&quot;data&quot;</span> <span class="token keyword">date</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token string">&quot;evento&quot;</span> <span class="token keyword">varchar</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>A completamento del comando, per uscire, basta digitare <code>exit</code>.</p> <h4 id="feathers-js"><a href="#feathers-js" class="header-anchor">#</a> Feathers.js</h4> <p>Feathers.js è l’API layer che ci permette di generare il codice del microservizio.</p> <p>Se usi javascript probabilmente hai <code>npm</code> già installato, quindi con il seguente comando puoi installare Feathers:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">npm</span> <span class="token function">install</span> @feathersjs/cli -g
</code></pre></div><h2 id="passo-1"><a href="#passo-1" class="header-anchor">#</a> Passo 1</h2> <p>Crea una nuova cartella, una volta dentro digita</p> <div class="language- extra-class"><pre class="language-text"><code>&gt; feathers generate app
</code></pre></div><p>Rispondi alle domande interattive (le scelte di default vanno bene per questo tutorial)</p> <h2 id="passo-2"><a href="#passo-2" class="header-anchor">#</a> Passo 2</h2> <p>Feathers ha generato un’impalcatura sulla quale costruire la nostra applicazione. Con il comando <code>npm start</code> puoi lanciarla ma sarà ancora vuota.</p> <p>Con il prossimo comando generi codice per l’API endpoint:</p> <div class="language- extra-class"><pre class="language-text"><code>&gt; feathers generate service
</code></pre></div><p>Alle domande che seguono rispondi che si tratta di un servizio <code>Sequelize</code> e usa <code>giorno</code> come nome. Infine scegli <code>PostgreSQL</code> quando richiesto. L’ultima domanda riguarda l’indirizzo del nostro database. Bisogna prestare un attimo di attenzione perché l’indirizzo proposto di default sarà</p> <div class="language- extra-class"><pre class="language-text"><code>postgres://postgres:@localhost:5432/calendar_api
</code></pre></div><p>che nel nostro caso va bene, eccettuato il fatto che manca la password, che va inserita dopo i due punti come segue:</p> <div class="language- extra-class"><pre class="language-text"><code>postgres://postgres:banana@localhost:5432/calendar_api
</code></pre></div><h2 id="passo-3"><a href="#passo-3" class="header-anchor">#</a> Passo 3</h2> <p>In grosso è fatto, ma la nostra API non ha ancora un modello. Navigando nella struttura creata da Feathers, apri il file <code>src/models/giorno.model.js</code>. Il codice che definisce il modello è il seguente:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> giorno <span class="token operator">=</span> sequelizeClient<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'giorno'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    text<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
      allowNull<span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">// altro codice riguardante gli hooks</span>
</code></pre></div><p>In pratica questo codice dice che la struttura della nostra risorsa è semplicemente una stringa. Quello che vogliamo creare è invece qualcosa del genere</p> <table><thead><tr><th>data</th> <th>evento</th></tr></thead> <tbody><tr><td>25-12-2019</td> <td>natale</td></tr> <tr><td>26-12-2019</td> <td>s. stefano</td></tr></tbody></table> <p>Per ottenerlo dobbiamo modificare il codice come segue:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> giorno <span class="token operator">=</span> sequelizeClient<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'giorno'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    data<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">DATEONLY</span><span class="token punctuation">,</span>
      allowNull<span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    evento<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
      allowNull<span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">// ... hooks ...</span>
</code></pre></div><p>Salva il file così modificato.</p> <h2 id="passo-4"><a href="#passo-4" class="header-anchor">#</a> Passo 4</h2> <p>Congratulazioni, il servizio è completo! È ora di provarlo. Se hai installato <a href="https://httpie.org/" target="_blank" rel="noopener noreferrer">http pie<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> puoi usare il comando:</p> <div class="language- extra-class"><pre><code>http POST :3030/giorno data=2019-12-25 evento=natale
</code></pre></div><p>Altrimenti con <code>curl</code></p> <div class="language- extra-class"><pre><code>curl -d '{&quot;data&quot;:&quot;2019-12-26&quot;, &quot;evento&quot;:&quot;s. stefano&quot;}' -H &quot;Content-Type: application/json&quot; -X POST http://localhost:3030/giorno
</code></pre></div><p>I comandi qui sopra creano nuove risorse, per controllare il risultato possiamo andare all’indirizzo qui sotto con il browser</p> <div class="language- extra-class"><pre><code>http://localhost:3030/giorno
</code></pre></div><p>Supponiamo di volere effettuare una query solo per i giorno successivi a natale. Sequelize offre la seguente sintassi di serie:</p> <div class="language- extra-class"><pre><code>http://localhost:3030/giorno?data[$gt]=2019-12-25
</code></pre></div><p>Dove il <code>$gt</code> sta per &quot;greater than&quot;.</p> <h2 id="conclusione"><a href="#conclusione" class="header-anchor">#</a> Conclusione</h2> <p>Prototipare un’API non è mai stato così veloce e semplice. Tuttavia non bisogna farsi ingannare dalla troppa semplicità di questi strumenti innovativi. Il microservizio che abbiamo costruito in pochi minuti potrà anche funzionare e avere tutte le funzionalità che cercavamo inizialmente, ma in ogni sistema informativo che si rispetti questo è destinato a cambiare.</p> <p>Con l’aumentare delle richieste di funzionalità sarà necessario aggiungere una struttura del codice più robusta o integrare con altri componenti software. Talvolta l’impostazione iniziale è talmente diversa dall’obiettivo che vogliamo raggiungere che è necessario cominciare da zero e riscrivere tutto in un linguaggio più estensibile e con tecnologie più flessibili.</p> <hr> <p><a href="https://www.linkedin.com/in/gurghet/?locale=it_ITs" target="_blank" rel="noopener noreferrer"><em>Andrea Passaglia</em><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><div id="HCB_comment_box"><a href="http://www.htmlcommentbox.com">
    Comment Form
  </a> is loading comments...
</div></p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.a2df8847.js" defer></script><script src="/assets/js/2.61b454c1.js" defer></script><script src="/assets/js/14.bdc856fe.js" defer></script><script src="/assets/js/9.5055760e.js" defer></script>
  </body>
</html>
